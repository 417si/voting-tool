<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŠ•ç¥¨çµæœ ğŸ†</title>
    <style>
        body { font-family: sans-serif; max-width: 500px; margin: 40px auto; padding: 20px; line-height: 1.6; background: #f0f2f5; }
        .card { background: white; padding: 30px; border-radius: 16px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); text-align: center; }
        h2 { color: #333; margin-bottom: 20px; border-bottom: 2px solid #ff6b6b; display: inline-block; padding-bottom: 5px; }
        .ranking-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; margin-bottom: 10px; background: #fff; border: 1px solid #eee; border-radius: 10px; transition: 0.3s; }
        .ranking-item:nth-child(1) { background: #fff9db; border-color: #fcc419; transform: scale(1.05); font-weight: bold; }
        .rank-badge { background: #ff6b6b; color: white; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: 14px; }
        .vote-count { color: #4dabf7; font-weight: bold; font-size: 1.2em; }
        .back-btn { margin-top: 20px; display: inline-block; text-decoration: none; color: #888; font-size: 14px; }
    </style>
</head>
<body>

<div class="card">
    <h2 id="pageTitle">é›†è¨ˆä¸­...</h2>
    <div id="rankingList">èª­ã¿è¾¼ã¿ä¸­...</div>
    <a href="index.html" class="back-btn">â† æŠ•ç¥¨ä½œæˆç”»é¢ã¸</a>
</div>

<script>
    // ã€é‡è¦ã€‘ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®CSVå…¬é–‹URLã‚’ã“ã“ã«è²¼ã‚‹
    const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQH2KeCHtO-q2IqDkKTEaoG8vLoihfN1uetAoZkVq2UGiQbGi1yrC0NVVe6Q9wnq5IE6nHl2BhUEZfe/pub?gid=490982875&single=true&output=csv";

    async function loadRanking() {
        const hash = window.location.hash.substring(1);
        if (!hash.startsWith("items=")) {
            document.getElementById('rankingList').innerText = "æŠ•ç¥¨ãƒšãƒ¼ã‚¸ãŒç‰¹å®šã§ãã¾ã›ã‚“ã€‚";
            return;
        }
        
        const encodedData = hash.replace("items=", "");
        const pageId = encodedData.substring(0, 10); // è­˜åˆ¥ã®ãŸã‚ã®å…ˆé ­10æ–‡å­—

        // ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒˆãƒ«ã‚’å¾©å…ƒ
        const decoded = decodeURIComponent(atob(encodedData));
        document.getElementById('pageTitle').innerText = "æŠ•ç¥¨çµæœ ğŸ†";

        try {
            const response = await fetch(CSV_URL + "&cache=" + new Date().getTime());
            const csvData = await response.text();
            
            // CSVã‚’è§£æï¼ˆç°¡æ˜“ç‰ˆï¼‰
            const rows = csvData.split('\n').map(row => row.split(','));
            const counts = {};

            rows.forEach(row => {
                // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®åˆ—ç•ªå·ï¼ˆBåˆ—=1, Cåˆ—=2ï¼‰ã«åˆã‚ã›ã¦èª¿æ•´ã—ã¦ãã ã•ã„
                const listId = row[1]?.replace(/"/g, '').trim(); 
                const itemName = row[2]?.replace(/"/g, '').trim(); 
                
                if (listId === pageId) {
                    counts[itemName] = (counts[itemName] || 0) + 1;
                }
            });

            const sorted = Object.entries(counts).sort((a, b) => b[1] - a[1]);
            const container = document.getElementById('rankingList');
            
            if (sorted.length === 0) {
                container.innerHTML = "<p>ã¾ã æŠ•ç¥¨ãŒã‚ã‚Šã¾ã›ã‚“ã€‚<br><small>â€»åæ˜ ã¾ã§æ•°åˆ†ã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™</small></p>";
                return;
            }

            container.innerHTML = sorted.map(([name, count], index) => `
                <div class="ranking-item">
                    <div style="display:flex; align-items:center; gap:10px;">
                        <span class="rank-badge">${index + 1}</span>
                        <span>${name}</span>
                    </div>
                    <span class="vote-count">${count} ç¥¨</span>
                </div>
            `).join('');

        } catch (e) {
            document.getElementById('rankingList').innerText = "ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚";
        }
    }

    loadRanking();
</script>
</body>
</html>
